<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>quatro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An attempt to provide a concrete, working example to demonstrate to C# developers how F# can improve their workflow and performance"/>
    <meta name="author" content="Daniel J. Summers"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/FromObjectsToFunctions/content/style.css" />
    <script type="text/javascript" src="/FromObjectsToFunctions/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/danieljsummers/FromObjectsToFunctions">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/FromObjectsToFunctions/index.html">objects () |> functions</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h3><a name="Quatro-Step-3" class="anchor" href="#Quatro-Step-3">Quatro - Step 3</a></h3>
<p>As with our previous versions, we'll start by adding the RethinkDB driver to <code>project.json</code>; we'll also bring the
<code>data-config.json</code> file from <strong>Dos</strong>/<strong>Tres</strong> into this project, changing the database name to <code>O2F4</code>. Follow the
<a href="tres.html">instructions for Tres</a> up though the point where it says "we'll create a file <code>Data.fs</code>".</p>
<p><strong>Parsing <code>data.config</code></strong></p>
<p>We'll use <code>Data.fs</code> in this project as well, but we'll do things a bit more functionally.  We'll use
<a href="https://xyncro.tech/chiron/">Chiron</a> to parse the JSON file, and we'll set up a discriminated union (DU) for our
configuration parameters.</p>
<p>First, to be able to use Chiron, we'll need the package.  Add the following line within the <code>dependencies</code> section:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="text">"Chiron": "6.2.1",
</code></pre></td></tr></table>
<p>Then, we'll start <code>Data.fs</code> with our DU.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">namespace</span> <span class="i">Quatro</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Chiron</span>
<span class="c">// other opens</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="t">ConfigParameter</span> <span class="o">=</span>
  | <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="p">Hostname</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="t">string</span>
  | <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="p">Port</span>     <span class="k">of</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="t">int</span>
  | <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="p">AuthKey</span>  <span class="k">of</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="t">string</span>
  | <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="p">Timeout</span>  <span class="k">of</span> <span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="t">int</span>
  | <span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="p">Database</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs4', 12)" onmouseover="showTip(event, 'fs4', 12)" class="t">string</span>
</code></pre></td>
</tr>
</table>
<p>This DU looks a bit different than the single-case DUs or enum-style DUs that
<a href="../step2/quatro.html">we made in step 2</a>.  This is a full-fledged DU with 5 different types, 3 strings and 2 integers.
The <code>DataConfig</code> record now becomes dead simple:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs23', 36)" onmouseover="showTip(event, 'fs23', 36)" class="t">DataConfig</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs24', 37)" onmouseover="showTip(event, 'fs24', 37)" class="i">Parameters</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 38)" onmouseover="showTip(event, 'fs2', 38)" class="t">ConfigParameter</span> <span onmouseout="hideTip(event, 'fs25', 39)" onmouseover="showTip(event, 'fs25', 39)" class="t">list</span> }
</code></pre></td>
</tr>
</table>
<p>We'll populate that using Chiron's <code>Json.parse</code> function.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">with</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs26', 40)" onmouseover="showTip(event, 'fs26', 40)" class="f">FromJson</span> <span onmouseout="hideTip(event, 'fs27', 41)" onmouseover="showTip(event, 'fs27', 41)" class="i">json</span> <span class="o">=</span>
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs28', 42)" onmouseover="showTip(event, 'fs28', 42)" class="i">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 43)" onmouseover="showTip(event, 'fs29', 43)" class="i">parse</span> <span onmouseout="hideTip(event, 'fs27', 44)" onmouseover="showTip(event, 'fs27', 44)" class="i">json</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs30', 45)" onmouseover="showTip(event, 'fs30', 45)" class="p">Object</span> <span onmouseout="hideTip(event, 'fs31', 46)" onmouseover="showTip(event, 'fs31', 46)" class="i">config</span> <span class="k">-&gt;</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 47)" onmouseover="showTip(event, 'fs32', 47)" class="i">options</span> <span class="o">=</span>
          <span onmouseout="hideTip(event, 'fs31', 48)" onmouseover="showTip(event, 'fs31', 48)" class="i">config</span>
          <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 49)" onmouseover="showTip(event, 'fs33', 49)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 50)" onmouseover="showTip(event, 'fs34', 50)" class="f">toList</span>
          <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs35', 51)" onmouseover="showTip(event, 'fs35', 51)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs36', 52)" onmouseover="showTip(event, 'fs36', 52)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs37', 53)" onmouseover="showTip(event, 'fs37', 53)" class="i">item</span> <span class="k">-&gt;</span>
              <span class="k">match</span> <span onmouseout="hideTip(event, 'fs37', 54)" onmouseover="showTip(event, 'fs37', 54)" class="i">item</span> <span class="k">with</span>
              | <span class="s">&quot;Hostname&quot;</span>, <span onmouseout="hideTip(event, 'fs38', 55)" onmouseover="showTip(event, 'fs38', 55)" class="p">String</span> <span onmouseout="hideTip(event, 'fs39', 56)" onmouseover="showTip(event, 'fs39', 56)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs3', 57)" onmouseover="showTip(event, 'fs3', 57)" class="p">Hostname</span> <span onmouseout="hideTip(event, 'fs39', 58)" onmouseover="showTip(event, 'fs39', 58)" class="i">x</span>
              | <span class="s">&quot;Port&quot;</span>,     <span onmouseout="hideTip(event, 'fs40', 59)" onmouseover="showTip(event, 'fs40', 59)" class="p">Number</span> <span onmouseout="hideTip(event, 'fs41', 60)" onmouseover="showTip(event, 'fs41', 60)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 61)" onmouseover="showTip(event, 'fs5', 61)" class="p">Port</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs6', 62)" onmouseover="showTip(event, 'fs6', 62)" class="f">int</span> <span onmouseout="hideTip(event, 'fs41', 63)" onmouseover="showTip(event, 'fs41', 63)" class="i">x</span>
              | <span class="s">&quot;AuthKey&quot;</span>,  <span onmouseout="hideTip(event, 'fs38', 64)" onmouseover="showTip(event, 'fs38', 64)" class="p">String</span> <span onmouseout="hideTip(event, 'fs39', 65)" onmouseover="showTip(event, 'fs39', 65)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs7', 66)" onmouseover="showTip(event, 'fs7', 66)" class="p">AuthKey</span> <span onmouseout="hideTip(event, 'fs39', 67)" onmouseover="showTip(event, 'fs39', 67)" class="i">x</span>
              | <span class="s">&quot;Timeout&quot;</span>,  <span onmouseout="hideTip(event, 'fs40', 68)" onmouseover="showTip(event, 'fs40', 68)" class="p">Number</span> <span onmouseout="hideTip(event, 'fs41', 69)" onmouseover="showTip(event, 'fs41', 69)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 70)" onmouseover="showTip(event, 'fs8', 70)" class="p">Timeout</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs6', 71)" onmouseover="showTip(event, 'fs6', 71)" class="f">int</span> <span onmouseout="hideTip(event, 'fs41', 72)" onmouseover="showTip(event, 'fs41', 72)" class="i">x</span>
              | <span class="s">&quot;Database&quot;</span>, <span onmouseout="hideTip(event, 'fs38', 73)" onmouseover="showTip(event, 'fs38', 73)" class="p">String</span> <span onmouseout="hideTip(event, 'fs39', 74)" onmouseover="showTip(event, 'fs39', 74)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs9', 75)" onmouseover="showTip(event, 'fs9', 75)" class="p">Database</span> <span onmouseout="hideTip(event, 'fs39', 76)" onmouseover="showTip(event, 'fs39', 76)" class="i">x</span>
              | <span onmouseout="hideTip(event, 'fs42', 77)" onmouseover="showTip(event, 'fs42', 77)" class="i">key</span>, <span onmouseout="hideTip(event, 'fs43', 78)" onmouseover="showTip(event, 'fs43', 78)" class="i">value</span> <span class="k">-&gt;</span>
                  <span onmouseout="hideTip(event, 'fs44', 79)" onmouseover="showTip(event, 'fs44', 79)" class="f">raise</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs45', 80)" onmouseover="showTip(event, 'fs45', 80)" class="t">InvalidOperationException</span>
                              (<span onmouseout="hideTip(event, 'fs46', 81)" onmouseover="showTip(event, 'fs46', 81)" class="f">sprintf</span> <span class="s">&quot;Unrecognized RethinkDB configuration parameter </span><span class="pf">%s</span><span class="s"> (value </span><span class="pf">%A</span><span class="s">)&quot;</span> <span class="i">key</span> <span onmouseout="hideTip(event, 'fs43', 82)" onmouseover="showTip(event, 'fs43', 82)" class="i">value</span>))
        { <span class="i">Parameters</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 83)" onmouseover="showTip(event, 'fs32', 83)" class="i">options</span> }
    | _ <span class="k">-&gt;</span> { <span class="i">Parameters</span> <span class="o">=</span> [] }
</code></pre></td>
</tr>
</table>
<p>There is a lot to learn in these lines.</p>
<ul>
<li>
Before, if the JSON didn't parse, we raised an exception, but that was about it.  In this one, if the JSON doesn't
parse, we get a default connection.  Maybe this is better, maybe not, but it demonstrates that there is a way to handle
bad JSON other than an exception.
</li>
<li>
<code>Object</code>, <code>String</code>, and <code>Number</code> are Chiron types (cases of a DU, actually), so our <code>match</code> statement uses the
destructuring form to "unwrap" the DU's inner value.  For <code>String</code>, <code>x</code> is a string, and for <code>Number</code>, <code>x</code> is a decimal
(that's why we run it through <code>int</code> to make our DUs.
</li>
<li>
This version will raise an exception if we attempt to set an option that we do not recognize (something like
"databsae" - not that anyone I know would ever type it like that...).
</li>
</ul>
<p>Now, we'll adapt the <code>CreateConnection ()</code> function to read this new configuration representation:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs47', 101)" onmouseover="showTip(event, 'fs47', 101)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs55', 102)" onmouseover="showTip(event, 'fs55', 102)" class="f">CreateConnection</span> () <span class="o">:</span> <span onmouseout="hideTip(event, 'fs56', 103)" onmouseover="showTip(event, 'fs56', 103)" class="t">IConnection</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 104)" onmouseover="showTip(event, 'fs57', 104)" class="f">folder</span> (<span onmouseout="hideTip(event, 'fs58', 105)" onmouseover="showTip(event, 'fs58', 105)" class="i">builder</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs59', 106)" onmouseover="showTip(event, 'fs59', 106)" class="i">Connection</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 107)" onmouseover="showTip(event, 'fs60', 107)" class="t">Builder</span>) <span onmouseout="hideTip(event, 'fs61', 108)" onmouseover="showTip(event, 'fs61', 108)" class="i">block</span> <span class="o">=</span>
      <span class="k">match</span> <span onmouseout="hideTip(event, 'fs61', 109)" onmouseover="showTip(event, 'fs61', 109)" class="i">block</span> <span class="k">with</span>
      | <span onmouseout="hideTip(event, 'fs3', 110)" onmouseover="showTip(event, 'fs3', 110)" class="p">Hostname</span> <span onmouseout="hideTip(event, 'fs39', 111)" onmouseover="showTip(event, 'fs39', 111)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 112)" onmouseover="showTip(event, 'fs58', 112)" class="i">builder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 113)" onmouseover="showTip(event, 'fs62', 113)" class="f">Hostname</span> <span onmouseout="hideTip(event, 'fs39', 114)" onmouseover="showTip(event, 'fs39', 114)" class="i">x</span>
      | <span onmouseout="hideTip(event, 'fs5', 115)" onmouseover="showTip(event, 'fs5', 115)" class="p">Port</span>     <span onmouseout="hideTip(event, 'fs63', 116)" onmouseover="showTip(event, 'fs63', 116)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 117)" onmouseover="showTip(event, 'fs58', 117)" class="i">builder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs64', 118)" onmouseover="showTip(event, 'fs64', 118)" class="f">Port</span>     <span onmouseout="hideTip(event, 'fs63', 119)" onmouseover="showTip(event, 'fs63', 119)" class="i">x</span>
      | <span onmouseout="hideTip(event, 'fs7', 120)" onmouseover="showTip(event, 'fs7', 120)" class="p">AuthKey</span>  <span onmouseout="hideTip(event, 'fs39', 121)" onmouseover="showTip(event, 'fs39', 121)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 122)" onmouseover="showTip(event, 'fs58', 122)" class="i">builder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs65', 123)" onmouseover="showTip(event, 'fs65', 123)" class="f">AuthKey</span>  <span onmouseout="hideTip(event, 'fs39', 124)" onmouseover="showTip(event, 'fs39', 124)" class="i">x</span>
      | <span onmouseout="hideTip(event, 'fs8', 125)" onmouseover="showTip(event, 'fs8', 125)" class="p">Timeout</span>  <span onmouseout="hideTip(event, 'fs63', 126)" onmouseover="showTip(event, 'fs63', 126)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 127)" onmouseover="showTip(event, 'fs58', 127)" class="i">builder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs66', 128)" onmouseover="showTip(event, 'fs66', 128)" class="f">Timeout</span>  <span onmouseout="hideTip(event, 'fs63', 129)" onmouseover="showTip(event, 'fs63', 129)" class="i">x</span>
      | <span onmouseout="hideTip(event, 'fs9', 130)" onmouseover="showTip(event, 'fs9', 130)" class="p">Database</span> <span onmouseout="hideTip(event, 'fs39', 131)" onmouseover="showTip(event, 'fs39', 131)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 132)" onmouseover="showTip(event, 'fs58', 132)" class="i">builder</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 133)" onmouseover="showTip(event, 'fs67', 133)" class="f">Db</span>       <span onmouseout="hideTip(event, 'fs39', 134)" onmouseover="showTip(event, 'fs39', 134)" class="i">x</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 135)" onmouseover="showTip(event, 'fs68', 135)" class="i">bldr</span> <span class="o">=</span>
      <span onmouseout="hideTip(event, 'fs47', 136)" onmouseover="showTip(event, 'fs47', 136)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 137)" onmouseover="showTip(event, 'fs24', 137)" class="i">Parameters</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs69', 138)" onmouseover="showTip(event, 'fs69', 138)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 139)" onmouseover="showTip(event, 'fs70', 139)" class="f">fold</span> <span onmouseout="hideTip(event, 'fs57', 140)" onmouseover="showTip(event, 'fs57', 140)" class="f">folder</span> (<span onmouseout="hideTip(event, 'fs71', 141)" onmouseover="showTip(event, 'fs71', 141)" class="t">RethinkDB</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 142)" onmouseover="showTip(event, 'fs72', 142)" class="i">R</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs73', 143)" onmouseover="showTip(event, 'fs73', 143)" class="f">Connection</span> ())
    <span class="k">upcast</span> <span onmouseout="hideTip(event, 'fs68', 144)" onmouseover="showTip(event, 'fs68', 144)" class="i">bldr</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs74', 145)" onmouseover="showTip(event, 'fs74', 145)" class="f">Connect</span>()
</code></pre></td>
</tr>
</table>
<p>Our folder function utilizes a <code>match</code> on our <code>ConfigParameter</code> DU.  Each time through, it <strong>will</strong> return a modified
version of the <code>builder</code> parameter, because one of them will match.  We then create our builder by folding the
parameter, using <code>R.Connection ()</code> as our beginning state, then return its <code>Connect ()</code> method.</p>
<p>For now, let's copy the rest of <code>Data.fs</code> from <strong>Tres</strong> to <strong>Quatro</strong> - this gives us the table constants and the
table/index initialization code.</p>
<p><strong>Dependency Injection: Functional Style</strong></p>
<p>One of the concepts that dependency injection is said to implement is "inversion of control;" rather than an object
compiling and linking a dependency at compile time, it compiles against an interface, and the concrete implementation
is provided at runtime.  (This is a bit of an oversimplification, but it's the basic gist.)  If you've ever done
non-DI/non-IoC work, and learned DI, you've adjusted your thinking from "what do I need" to "what will I need".  In the
functional world, this is done through a concept called the <strong><code>Reader</code> monad</strong>.  The basic concept is as follows:</p>
<ul>
<li>We have a set of dependencies that we establish and set up in our code.</li>
<li>
We a process with a dependency that we want to be injected (in our example, our <code>IConnection</code> is one such
dependency).
</li>
<li>
We construct a function that requires this dependency, and returns the result we seek.  Though we won't see it in
this step, it's easy to imagine a function that requires an <code>IConnection</code> and returns a <code>Post</code>.
</li>
<li>We create a function that, given our set of dependencies, will extract the one we need for this process.</li>
<li>
We run our dependencies through the extraction function, to the dependent function, which takes the dependency and
returns the result.
</li>
</ul>
<p>Confused yet?  Me too - let's look at code instead.  Let's create <code>Dependencies.fs</code> and add it to the build order above
<code>Entities.fs</code>.  This write-up won't expound on every line in this file, but we'll hit the highlights to see how all
this comes together.  <code>ReaderM</code> is a generic class, where the first type is the dependency we need, and the second type
is the type of our result.</p>
<p>After that (which will come back to in a bit), we'll create our dependencies, and a function to extract an
<code>IConnection</code> from it.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs75', 146)" onmouseover="showTip(event, 'fs75', 146)" class="t">IDependencies</span> <span class="o">=</span>
  <span class="k">abstract</span> <span onmouseout="hideTip(event, 'fs76', 147)" onmouseover="showTip(event, 'fs76', 147)" class="i">Conn</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs56', 148)" onmouseover="showTip(event, 'fs56', 148)" class="t">IConnection</span>

[&lt;<span onmouseout="hideTip(event, 'fs77', 149)" onmouseover="showTip(event, 'fs77', 149)" class="t">AutoOpen</span>&gt;]
<span class="k">module</span> <span class="t">DependencyExtraction</span> <span class="o">=</span>

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 150)" onmouseover="showTip(event, 'fs78', 150)" class="f">getConn</span> (<span onmouseout="hideTip(event, 'fs79', 151)" onmouseover="showTip(event, 'fs79', 151)" class="i">deps</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs75', 152)" onmouseover="showTip(event, 'fs75', 152)" class="t">IDependencies</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs79', 153)" onmouseover="showTip(event, 'fs79', 153)" class="i">deps</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs80', 154)" onmouseover="showTip(event, 'fs80', 154)" class="i">Conn</span>
</code></pre></td>
</tr>
</table>
<p>Our <code>IDependencies</code> are pretty lean right now, but that's OK; we'll flesh it out in future steps.  We also wrote a
dead-easy function to get the connection; the signature is literally <code>IDependencies -&gt; IConnection</code>.  No <code>ReaderM</code>
funkiness yet!</p>
<p>Now that we have a dependency "set" (of one), we need to go to <code>App.fs</code> and make sure we actually have a concrete
instance of this for runtime.  Add this just below the module declaration:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs115', 233)" onmouseover="showTip(event, 'fs115', 233)" class="i">lazyCfg</span> <span class="o">=</span> <span class="k">lazy</span> (<span onmouseout="hideTip(event, 'fs116', 234)" onmouseover="showTip(event, 'fs116', 234)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 235)" onmouseover="showTip(event, 'fs117', 235)" class="f">ReadAllText</span> <span class="s">&quot;data-config.json&quot;</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 236)" onmouseover="showTip(event, 'fs23', 236)" class="t">DataConfig</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs118', 237)" onmouseover="showTip(event, 'fs118', 237)" class="f">FromJson</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 238)" onmouseover="showTip(event, 'fs119', 238)" class="i">cfg</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs115', 239)" onmouseover="showTip(event, 'fs115', 239)" class="i">lazyCfg</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs120', 240)" onmouseover="showTip(event, 'fs120', 240)" class="f">Force</span>()
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs121', 241)" onmouseover="showTip(event, 'fs121', 241)" class="i">deps</span> <span class="o">=</span> {
    <span class="k">new</span> <span onmouseout="hideTip(event, 'fs75', 242)" onmouseover="showTip(event, 'fs75', 242)" class="t">IDependencies</span> <span class="k">with</span>
      <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span class="i">Conn</span>
        <span class="k">with</span> <span class="i">get</span> () <span class="o">=</span>
          <span class="k">let</span> <span onmouseout="hideTip(event, 'fs122', 243)" onmouseover="showTip(event, 'fs122', 243)" class="i">conn</span> <span class="o">=</span> <span class="k">lazy</span> (<span onmouseout="hideTip(event, 'fs119', 244)" onmouseover="showTip(event, 'fs119', 244)" class="i">cfg</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs123', 245)" onmouseover="showTip(event, 'fs123', 245)" class="f">CreateConnection</span> ())
          <span onmouseout="hideTip(event, 'fs122', 246)" onmouseover="showTip(event, 'fs122', 246)" class="i">conn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs120', 247)" onmouseover="showTip(event, 'fs120', 247)" class="f">Force</span>()
  }
</code></pre></td>
</tr>
</table>
<p>Here, we're using <code>lazy</code> to do this once-only-and-only-on-demand, then we turn around and pretty much demand it.  If
you're thinking this sounds a lot like singletons - your thinking is superb!  That's exactly what we're doing here.
We're also using F#'s inline interface declaration to create an implementation without creating a concrete class in
which it is held.</p>
<p>Maybe being our own IoC container isn't so bad!  Now, let's take a stab at actually connection, and running the
<code>EstablishEnvironment</code> function on startup.  At the top of <code>main</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs125', 249)" onmouseover="showTip(event, 'fs125', 249)" class="f">initDb</span> (<span onmouseout="hideTip(event, 'fs102', 250)" onmouseover="showTip(event, 'fs102', 250)" class="i">conn</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs56', 251)" onmouseover="showTip(event, 'fs56', 251)" class="t">IConnection</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs102', 252)" onmouseover="showTip(event, 'fs102', 252)" class="i">conn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs126', 253)" onmouseover="showTip(event, 'fs126', 253)" class="f">EstablishEnvironment</span> <span onmouseout="hideTip(event, 'fs119', 254)" onmouseover="showTip(event, 'fs119', 254)" class="i">cfg</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 255)" onmouseover="showTip(event, 'fs127', 255)" class="i">Database</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 256)" onmouseover="showTip(event, 'fs89', 256)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs128', 257)" onmouseover="showTip(event, 'fs128', 257)" class="f">RunSynchronously</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 258)" onmouseover="showTip(event, 'fs129', 258)" class="f">start</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 259)" onmouseover="showTip(event, 'fs19', 259)" class="f">liftDep</span> <span onmouseout="hideTip(event, 'fs78', 260)" onmouseover="showTip(event, 'fs78', 260)" class="f">getConn</span> <span onmouseout="hideTip(event, 'fs125', 261)" onmouseover="showTip(event, 'fs125', 261)" class="f">initDb</span>
    <span onmouseout="hideTip(event, 'fs129', 262)" onmouseover="showTip(event, 'fs129', 262)" class="f">start</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 263)" onmouseover="showTip(event, 'fs16', 263)" class="f">run</span> <span onmouseout="hideTip(event, 'fs121', 264)" onmouseover="showTip(event, 'fs121', 264)" class="i">deps</span>
</code></pre></td>
</tr>
</table>
<p>But wait - we don't have a <code>Database</code> property on our data config; our configuration is just a list of
<code>ConfigParameter</code> selections.  No worries, though; we can expose a database property on it pretty easily.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs47', 84)" onmouseover="showTip(event, 'fs47', 84)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 85)" onmouseover="showTip(event, 'fs48', 85)" class="i">Database</span> <span class="o">=</span>
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs47', 86)" onmouseover="showTip(event, 'fs47', 86)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 87)" onmouseover="showTip(event, 'fs24', 87)" class="i">Parameters</span>
          <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs35', 88)" onmouseover="showTip(event, 'fs35', 88)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 89)" onmouseover="showTip(event, 'fs49', 89)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs50', 90)" onmouseover="showTip(event, 'fs50', 90)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">match</span> <span onmouseout="hideTip(event, 'fs50', 91)" onmouseover="showTip(event, 'fs50', 91)" class="i">x</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs9', 92)" onmouseover="showTip(event, 'fs9', 92)" class="p">Database</span> _ <span class="k">-&gt;</span> <span class="k">true</span> | _ <span class="k">-&gt;</span> <span class="k">false</span>)
          <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs35', 93)" onmouseover="showTip(event, 'fs35', 93)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 94)" onmouseover="showTip(event, 'fs51', 94)" class="f">tryHead</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs52', 95)" onmouseover="showTip(event, 'fs52', 95)" class="p">Some</span> (<span onmouseout="hideTip(event, 'fs9', 96)" onmouseover="showTip(event, 'fs9', 96)" class="p">Database</span> <span onmouseout="hideTip(event, 'fs39', 97)" onmouseover="showTip(event, 'fs39', 97)" class="i">x</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs39', 98)" onmouseover="showTip(event, 'fs39', 98)" class="i">x</span>
    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs53', 99)" onmouseover="showTip(event, 'fs53', 99)" class="t">RethinkDBConstants</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 100)" onmouseover="showTip(event, 'fs54', 100)" class="i">DefaultDbName</span>
</code></pre></td>
</tr>
</table>
<p>OK - now our red squiggly lines are gone.  Now, if Jiminy Cricket had written F#, he would have told Pinocchio "Let the
types be your guide".  So, how are we doing with these?  <code>initDb</code> has the signature <code>IConnection -&gt; unit</code>, <code>start</code> has
the signature <code>ReaderM&lt;IDependencies, unit&gt;</code>, and the third line is simply <code>unit</code>.  And, were we to run it, it would
work, but... it's not really composable.</p>
<p>Creating extension methods on objects works great in C#-land, and as we've seen, it works the same way in F#-land.
However, in the case where we want to write functions that expect an <code>IConnection</code> and return our expected result,
extension methods are not what we need.  Let's change our <code>AutoOpen</code>ed <code>DataExtensions</code> module to something like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span onmouseout="hideTip(event, 'fs98', 195)" onmouseover="showTip(event, 'fs98', 195)" class="t">RequireQualifiedAccess</span>&gt;]
<span class="k">module</span> <span onmouseout="hideTip(event, 'fs99', 196)" onmouseover="showTip(event, 'fs99', 196)" class="t">Data</span> <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs100', 197)" onmouseover="showTip(event, 'fs100', 197)" class="f">establishEnvironment</span> <span onmouseout="hideTip(event, 'fs101', 198)" onmouseover="showTip(event, 'fs101', 198)" class="i">database</span> <span onmouseout="hideTip(event, 'fs102', 199)" onmouseover="showTip(event, 'fs102', 199)" class="i">conn</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs103', 200)" onmouseover="showTip(event, 'fs103', 200)" class="i">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs71', 201)" onmouseover="showTip(event, 'fs71', 201)" class="t">RethinkDB</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 202)" onmouseover="showTip(event, 'fs72', 202)" class="i">R</span>
    <span class="c">// etc.</span>
</code></pre></td>
</tr>
</table>
<p>Now, we have a function with the signature <code>string -&gt; IConnection -&gt; Async&lt;unit&gt;</code>.  This gets us close, but we still
have issues on either side of that signature.  On the front, if we were just hard-coding the database name, we could
drop the string parameter, and we'd have our <code>IConnection</code> as the first parameter.  On the return value, we will need
to run the <code>Async</code> workflow (remember, in F#, they're not started automatically); we need <code>unit</code>, not <code>Async&lt;unit&gt;</code>.</p>
<p>We'll use two key F# concepts to fix this up.  Currying (also known as partial application) allows us to look at every
return value that isn't the result as a function that's one step closer.  Looking at our signature above, you could
express it in English as "a function that takes a string, and returns a function that takes an <code>IConnection</code> and
returns an <code>Async</code> workflow."  So, to get a function that starts with an <code>IConnection</code>, we just provide the database
name.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs131', 275)" onmouseover="showTip(event, 'fs131', 275)" class="f">almost</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs130', 276)" onmouseover="showTip(event, 'fs130', 276)" class="t">Data</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs100', 277)" onmouseover="showTip(event, 'fs100', 277)" class="f">establishEnvironment</span> <span onmouseout="hideTip(event, 'fs119', 278)" onmouseover="showTip(event, 'fs119', 278)" class="i">cfg</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 279)" onmouseover="showTip(event, 'fs127', 279)" class="i">Database</span>
</code></pre></td>
</tr>
</table>
<p>The signature for <code>almost</code> is <code>IConnection -&gt; Async&lt;unit&gt;</code>.  Just what we want.  For the latter, we use composition.
This is a word that can be used, for example, to describe the way the collection modules expect the collection as the
final parameter, allowing the output of one to be piped, using the <code>|&gt;</code> operator, to the input of the next.  The other
is with the <code>&gt;&gt;</code> operator, which says to use the output of the first function as the input of the second function,
creating a single function from the two.  This is the one we'll use to run our <code>Async</code> workflow.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs132', 280)" onmouseover="showTip(event, 'fs132', 280)" class="f">money</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs130', 281)" onmouseover="showTip(event, 'fs130', 281)" class="t">Data</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs100', 282)" onmouseover="showTip(event, 'fs100', 282)" class="f">establishEnvironment</span> <span onmouseout="hideTip(event, 'fs119', 283)" onmouseover="showTip(event, 'fs119', 283)" class="i">cfg</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 284)" onmouseover="showTip(event, 'fs127', 284)" class="i">Database</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs89', 285)" onmouseover="showTip(event, 'fs89', 285)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs128', 286)" onmouseover="showTip(event, 'fs128', 286)" class="f">RunSynchronously</span>
</code></pre></td>
</tr>
</table>
<p>The signature for <code>money</code> is now <code>IConnection -&gt; unit</code>, just like we need.</p>
<p>Now, let's revisit <code>initDb</code> above.  Since we don't need the <code>IConnection</code> as a parameter, we can change that definition
to the same thing we have for <code>money</code> above.  And, since we don't need the parameter, we can just inline the call after
<code>getConn</code>; we'll just need to wrap the expression in parentheses to indicate that it's a function on its own.  And, we
don't need the definition of <code>start</code> anymore either - we can just pipe our entire expression into <code>run deps</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">    <span onmouseout="hideTip(event, 'fs19', 265)" onmouseover="showTip(event, 'fs19', 265)" class="f">liftDep</span> <span onmouseout="hideTip(event, 'fs78', 266)" onmouseover="showTip(event, 'fs78', 266)" class="f">getConn</span> (<span onmouseout="hideTip(event, 'fs130', 267)" onmouseover="showTip(event, 'fs130', 267)" class="t">Data</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs100', 268)" onmouseover="showTip(event, 'fs100', 268)" class="f">establishEnvironment</span> <span onmouseout="hideTip(event, 'fs119', 269)" onmouseover="showTip(event, 'fs119', 269)" class="i">cfg</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 270)" onmouseover="showTip(event, 'fs127', 270)" class="i">Database</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs89', 271)" onmouseover="showTip(event, 'fs89', 271)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs128', 272)" onmouseover="showTip(event, 'fs128', 272)" class="f">RunSynchronously</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 273)" onmouseover="showTip(event, 'fs16', 273)" class="f">run</span> <span onmouseout="hideTip(event, 'fs121', 274)" onmouseover="showTip(event, 'fs121', 274)" class="i">deps</span>
</code></pre></td>
</tr>
</table>
<p>It works!  We set up our dependencies, we composed a function using a dependency, and we used a <code>Reader</code> monad to make
it all work.  But, how did it work?  Given what we just learned above, let's look at the steps; we're coders, not
magicians.</p>
<p>First up, <code>liftDeps</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 28)" onmouseover="showTip(event, 'fs19', 28)" class="f">liftDep</span> (<span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="f">proj</span> <span class="o">:</span> <span class="o">&#39;</span><span class="i">d2</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">d1</span>) (<span onmouseout="hideTip(event, 'fs21', 30)" onmouseover="showTip(event, 'fs21', 30)" class="f">rm</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs15', 31)" onmouseover="showTip(event, 'fs15', 31)" class="t">ReaderM</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">d1</span>, <span class="o">&#39;</span><span class="i">output</span><span class="o">&gt;</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs15', 32)" onmouseover="showTip(event, 'fs15', 32)" class="t">ReaderM</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">d2</span>, <span class="o">&#39;</span><span class="i">output</span><span class="o">&gt;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 33)" onmouseover="showTip(event, 'fs20', 33)" class="f">proj</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs21', 34)" onmouseover="showTip(event, 'fs21', 34)" class="f">rm</span>
</code></pre></td>
</tr>
</table>
<p>The <code>proj</code> parameter is defined as a function that takes one value and returns another one.  The <code>rm</code> parameter is a
<code>Reader</code> monad that takes the <strong>return</strong> value of <code>proj</code>, and returns a <code>Reader</code> monad that takes the <strong>parameter</strong>
value of <code>proj</code> and returns an output type.  We passed <code>getConn</code> as the <code>proj</code> parameter, and its signature is
<code>IDependencies -&gt; IConnection</code>; the second parameter was a function with the signature <code>IConnection -&gt; unit</code>.  Where
does this turn into a <code>ReaderM</code>?  Why, the definition, of course!</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs15', 21)" onmouseover="showTip(event, 'fs15', 21)" class="t">ReaderM</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">d</span>, <span class="o">&#39;</span><span class="i">out</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&#39;</span><span class="i">d</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">out</span>
</code></pre></td>
</tr>
</table>
<p>So, <code>liftDep</code> derived the expected <code>ReaderM</code> type from <code>getConn</code>; <code>'d1</code> is <code>IDependencies</code> and <code>'d2</code> is <code>IConnection</code>.
This means that the next parameter should be a function which takes an <code>IConnection</code> and returns the output of the type
we expect.  Since we pass in <code>IConnection -&gt; unit</code>, <code>output</code> is <code>unit</code>.  When all is said and done, if we were to
assign a value to the top line, we would end up with <code>ReaderM&lt;IDependencies, unit&gt;</code>.</p>
<p>Now, to run it.  <code>run</code> is defined as:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="f">run</span> <span onmouseout="hideTip(event, 'fs17', 23)" onmouseover="showTip(event, 'fs17', 23)" class="i">dep</span> (<span onmouseout="hideTip(event, 'fs18', 24)" onmouseover="showTip(event, 'fs18', 24)" class="f">rm</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs15', 25)" onmouseover="showTip(event, 'fs15', 25)" class="t">ReaderM</span><span class="o">&lt;</span>_,_<span class="o">&gt;</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 26)" onmouseover="showTip(event, 'fs18', 26)" class="f">rm</span> <span onmouseout="hideTip(event, 'fs17', 27)" onmouseover="showTip(event, 'fs17', 27)" class="i">dep</span>
</code></pre></td>
</tr>
</table>
<p>This is way easier than what we've seen up to this point.  It takes an object and a <code>ReaderM</code>, and applies the object
to the first parameter of the monad.  By <code>|&gt;</code>ing the <code>ReaderM&lt;IDependencies, unit&gt;</code> to it, and providing our
<code>IDependencies</code> instance, we receive the result; the reader has successfully encapsulated all the functions below it.
From this point on, we'll just make sure our types are correct, and we'll be able to utilize not only an <code>IConnection</code>
for data manipulation, but any other dependencies we may need to define.</p>
<p>Take a deep breath.  Step 3 is done, and not only does it work, we understand why it works.</p>
<p><a href="../step3">Back to Step 3</a></p>

<div class="tip" id="fs1">module Chiron</div>
<div class="tip" id="fs2">type ConfigParameter =<br />&#160;&#160;| Hostname of string<br />&#160;&#160;| Port of int<br />&#160;&#160;| AuthKey of string<br />&#160;&#160;| Timeout of int<br />&#160;&#160;| Database of string<br /><br />Full name: Quatro.ConfigParameter</div>
<div class="tip" id="fs3">union case ConfigParameter.Hostname: string -&gt; ConfigParameter</div>
<div class="tip" id="fs4">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs5">union case ConfigParameter.Port: int -&gt; ConfigParameter</div>
<div class="tip" id="fs6">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs7">union case ConfigParameter.AuthKey: string -&gt; ConfigParameter</div>
<div class="tip" id="fs8">union case ConfigParameter.Timeout: int -&gt; ConfigParameter</div>
<div class="tip" id="fs9">union case ConfigParameter.Database: string -&gt; ConfigParameter</div>
<div class="tip" id="fs10">namespace RethinkDb</div>
<div class="tip" id="fs11">namespace RethinkDb.Driver</div>
<div class="tip" id="fs12">namespace RethinkDb.Driver.Net</div>
<div class="tip" id="fs13">namespace System</div>
<div class="tip" id="fs14">namespace System.IO</div>
<div class="tip" id="fs15">type ReaderM&lt;&#39;d,&#39;out&gt; = &#39;d -&gt; &#39;out<br /><br />Full name: Quatro.ReaderM&lt;_,_&gt;</div>
<div class="tip" id="fs16">val run : dep:&#39;a -&gt; rm:ReaderM&lt;&#39;a,&#39;b&gt; -&gt; &#39;b<br /><br />Full name: Quatro.Reader.run</div>
<div class="tip" id="fs17">val dep : &#39;a</div>
<div class="tip" id="fs18">val rm : ReaderM&lt;&#39;a,&#39;b&gt;</div>
<div class="tip" id="fs19">val liftDep : proj:(&#39;d2 -&gt; &#39;d1) -&gt; rm:ReaderM&lt;&#39;d1,&#39;output&gt; -&gt; ReaderM&lt;&#39;d2,&#39;output&gt;<br /><br />Full name: Quatro.Reader.liftDep</div>
<div class="tip" id="fs20">val proj : (&#39;d2 -&gt; &#39;d1)</div>
<div class="tip" id="fs21">val rm : ReaderM&lt;&#39;d1,&#39;output&gt;</div>
<div class="tip" id="fs22">module Reader<br /><br />from Quatro</div>
<div class="tip" id="fs23">type DataConfig =<br />&#160;&#160;{Parameters: ConfigParameter list;}<br />&#160;&#160;member CreateConnection : unit -&gt; IConnection<br />&#160;&#160;member Database : string<br />&#160;&#160;static member FromJson : json:&#39;a -&gt; DataConfig<br /><br />Full name: Quatro.DataConfig</div>
<div class="tip" id="fs24">DataConfig.Parameters: ConfigParameter list</div>
<div class="tip" id="fs25">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs26">static member DataConfig.FromJson : json:&#39;a -&gt; DataConfig<br /><br />Full name: Quatro.DataConfig.FromJson</div>
<div class="tip" id="fs27">val json : &#39;a</div>
<div class="tip" id="fs28">Multiple items<br />module Json<br /><br />from Chiron.Mapping<br /><br />--------------------<br />module Json<br /><br />from Chiron.Formatting<br /><br />--------------------<br />module Json<br /><br />from Chiron.Parsing<br /><br />--------------------<br />module Json<br /><br />from Chiron.Optics<br /><br />--------------------<br />module Json<br /><br />from Chiron.Functional<br /><br />--------------------<br /><br />--------------------<br />type Json&lt;&#39;a&gt; = Json -&gt; JsonResult&lt;&#39;a&gt; * Json<br /><br />Full name: Chiron.Functional.Json&lt;_&gt;</div>
<div class="tip" id="fs29"></div>
<div class="tip" id="fs30">Multiple items<br />type Object =<br />&#160;&#160;new : unit -&gt; obj<br />&#160;&#160;member Equals : obj:obj -&gt; bool<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;member GetType : unit -&gt; Type<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;static member Equals : objA:obj * objB:obj -&gt; bool<br />&#160;&#160;static member ReferenceEquals : objA:obj * objB:obj -&gt; bool<br /><br />Full name: System.Object<br /><br />--------------------<br />Object() : unit</div>
<div class="tip" id="fs31">val config : Map&lt;string,Json&gt;</div>
<div class="tip" id="fs32">val options : ConfigParameter list</div>
<div class="tip" id="fs33">Multiple items<br />module Map<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Map&lt;&#39;Key,&#39;Value (requires comparison)&gt; =<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface ICollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface IDictionary&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member Add : key:&#39;Key * value:&#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member ContainsKey : key:&#39;Key -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member Remove : key:&#39;Key -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Map&lt;_,_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="tip" id="fs34">val toList : table:Map&lt;&#39;Key,&#39;T&gt; -&gt; (&#39;Key * &#39;T) list (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.toList</div>
<div class="tip" id="fs35">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs36">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs37">val item : string * Json</div>
<div class="tip" id="fs38">Multiple items<br />type String =<br />&#160;&#160;new : value:char -&gt; string + 7 overloads<br />&#160;&#160;member Chars : int -&gt; char<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;member Contains : value:string -&gt; bool<br />&#160;&#160;member CopyTo : sourceIndex:int * destination:char[] * destinationIndex:int * count:int -&gt; unit<br />&#160;&#160;member EndsWith : value:string -&gt; bool + 2 overloads<br />&#160;&#160;member Equals : obj:obj -&gt; bool + 2 overloads<br />&#160;&#160;member GetEnumerator : unit -&gt; CharEnumerator<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;...<br /><br />Full name: System.String<br /><br />--------------------<br />String(value: nativeptr&lt;char&gt;) : unit<br />String(value: nativeptr&lt;sbyte&gt;) : unit<br />String(value: char []) : unit<br />String(c: char, count: int) : unit<br />String(value: nativeptr&lt;char&gt;, startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int) : unit<br />String(value: char [], startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int, enc: Text.Encoding) : unit</div>
<div class="tip" id="fs39">val x : string</div>
<div class="tip" id="fs40">union case Json.Number: decimal -&gt; Json</div>
<div class="tip" id="fs41">val x : decimal</div>
<div class="tip" id="fs42">val key : string</div>
<div class="tip" id="fs43">val value : Json</div>
<div class="tip" id="fs44">val raise : exn:Exception -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.raise</div>
<div class="tip" id="fs45">Multiple items<br />type InvalidOperationException =<br />&#160;&#160;inherit SystemException<br />&#160;&#160;new : unit -&gt; InvalidOperationException + 2 overloads<br /><br />Full name: System.InvalidOperationException<br /><br />--------------------<br />InvalidOperationException() : unit<br />InvalidOperationException(message: string) : unit<br />InvalidOperationException(message: string, innerException: exn) : unit</div>
<div class="tip" id="fs46">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs47">val this : DataConfig</div>
<div class="tip" id="fs48">member DataConfig.Database : string<br /><br />Full name: Quatro.DataConfig.Database</div>
<div class="tip" id="fs49">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs50">val x : ConfigParameter</div>
<div class="tip" id="fs51">val tryHead : list:&#39;T list -&gt; &#39;T option<br /><br />Full name: Microsoft.FSharp.Collections.List.tryHead</div>
<div class="tip" id="fs52">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs53">Multiple items<br />type RethinkDBConstants =<br />&#160;&#160;new : unit -&gt; RethinkDBConstants<br />&#160;&#160;static val DefaultDbName : string<br />&#160;&#160;static val DefaultHostname : string<br />&#160;&#160;static val DefaultAuthkey : string<br />&#160;&#160;static val DefaultPort : int<br />&#160;&#160;static val DefaultTimeout : int<br />&#160;&#160;nested type Protocol<br /><br />Full name: RethinkDb.Driver.RethinkDBConstants<br /><br />--------------------<br />RethinkDBConstants() : unit</div>
<div class="tip" id="fs54">field RethinkDBConstants.DefaultDbName = &quot;test&quot;</div>
<div class="tip" id="fs55">member DataConfig.CreateConnection : unit -&gt; IConnection<br /><br />Full name: Quatro.DataConfig.CreateConnection</div>
<div class="tip" id="fs56">type IConnection =<br />&#160;&#160;member RunAsync&lt;&#39;T&gt; : term:ReqlAst * globalOpts:obj * cancelToken:CancellationToken -&gt; Task&lt;obj&gt;<br />&#160;&#160;member RunAtomAsync&lt;&#39;T&gt; : term:ReqlAst * globalOpts:obj * cancelToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />&#160;&#160;member RunCursorAsync&lt;&#39;T&gt; : term:ReqlAst * globalOpts:obj * cancelToken:CancellationToken -&gt; Task&lt;Cursor&lt;&#39;T&gt;&gt;<br />&#160;&#160;member RunNoReply : term:ReqlAst * globalOpts:obj -&gt; unit<br />&#160;&#160;member RunResultAsync&lt;&#39;T&gt; : term:ReqlAst * globalOpts:obj * cancelToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br /><br />Full name: RethinkDb.Driver.Net.IConnection</div>
<div class="tip" id="fs57">val folder : (Connection.Builder -&gt; ConfigParameter -&gt; Connection.Builder)</div>
<div class="tip" id="fs58">val builder : Connection.Builder</div>
<div class="tip" id="fs59">type Connection =<br />&#160;&#160;member CheckOpen : unit -&gt; unit<br />&#160;&#160;member ClientEndPoint : IPEndPoint<br />&#160;&#160;member Close : ?shouldNoReplyWait:bool -&gt; unit<br />&#160;&#160;member Db : string<br />&#160;&#160;member Dispose : unit -&gt; unit<br />&#160;&#160;member HasError : bool<br />&#160;&#160;member Hostname : string<br />&#160;&#160;member NoReplyWait : unit -&gt; unit<br />&#160;&#160;member NoReplyWaitAsync : ?cancelToken:CancellationToken -&gt; Task<br />&#160;&#160;member Open : bool<br />&#160;&#160;...<br />&#160;&#160;nested type Builder<br /><br />Full name: RethinkDb.Driver.Net.Connection</div>
<div class="tip" id="fs60">type Builder =<br />&#160;&#160;new : unit -&gt; Builder<br />&#160;&#160;member AuthKey : key:string -&gt; Builder<br />&#160;&#160;member Connect : unit -&gt; Connection<br />&#160;&#160;member ConnectAsync : unit -&gt; Task&lt;Connection&gt;<br />&#160;&#160;member Db : val:string -&gt; Builder<br />&#160;&#160;member Hostname : val:string -&gt; Builder<br />&#160;&#160;member Port : val:int -&gt; Builder<br />&#160;&#160;member Timeout : val:int -&gt; Builder<br />&#160;&#160;member User : user:string * password:string -&gt; Builder<br /><br />Full name: RethinkDb.Driver.Net.Connection.Builder</div>
<div class="tip" id="fs61">val block : ConfigParameter</div>
<div class="tip" id="fs62">Connection.Builder.Hostname(val: string) : Connection.Builder</div>
<div class="tip" id="fs63">val x : int</div>
<div class="tip" id="fs64">Connection.Builder.Port(val: int) : Connection.Builder</div>
<div class="tip" id="fs65">Connection.Builder.AuthKey(key: string) : Connection.Builder</div>
<div class="tip" id="fs66">Connection.Builder.Timeout(val: int) : Connection.Builder</div>
<div class="tip" id="fs67">Connection.Builder.Db(val: string) : Connection.Builder</div>
<div class="tip" id="fs68">val bldr : Connection.Builder</div>
<div class="tip" id="fs69">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs70">val fold : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.Seq.fold</div>
<div class="tip" id="fs71">Multiple items<br />type RethinkDB =<br />&#160;&#160;inherit TopLevel<br />&#160;&#160;new : unit -&gt; RethinkDB<br />&#160;&#160;member Connection : unit -&gt; Builder<br />&#160;&#160;member ConnectionPool : unit -&gt; Builder<br />&#160;&#160;static val R : RethinkDB<br /><br />Full name: RethinkDb.Driver.RethinkDB<br /><br />--------------------<br />RethinkDB() : unit</div>
<div class="tip" id="fs72">field RethinkDB.R</div>
<div class="tip" id="fs73">RethinkDB.Connection() : Connection.Builder</div>
<div class="tip" id="fs74">Connection.Builder.Connect() : Connection</div>
<div class="tip" id="fs75">type IDependencies =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;abstract member Conn : IConnection<br />&#160;&#160;end<br /><br />Full name: Quatro.IDependencies</div>
<div class="tip" id="fs76">abstract member IDependencies.Conn : IConnection<br /><br />Full name: Quatro.IDependencies.Conn</div>
<div class="tip" id="fs77">Multiple items<br />type AutoOpenAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; AutoOpenAttribute<br />&#160;&#160;new : path:string -&gt; AutoOpenAttribute<br />&#160;&#160;member Path : string<br /><br />Full name: Microsoft.FSharp.Core.AutoOpenAttribute<br /><br />--------------------<br />new : unit -&gt; AutoOpenAttribute<br />new : path:string -&gt; AutoOpenAttribute</div>
<div class="tip" id="fs78">val getConn : deps:IDependencies -&gt; IConnection<br /><br />Full name: Quatro.DependencyExtraction.getConn</div>
<div class="tip" id="fs79">val deps : IDependencies</div>
<div class="tip" id="fs80">property IDependencies.Conn: IConnection</div>
<div class="tip" id="fs81">namespace System.Threading</div>
<div class="tip" id="fs82">namespace System.Threading.Tasks</div>
<div class="tip" id="fs83">type AsyncBuilder =<br />&#160;&#160;private new : unit -&gt; AsyncBuilder<br />&#160;&#160;member Bind : computation:Async&lt;&#39;T&gt; * binder:(&#39;T -&gt; Async&lt;&#39;U&gt;) -&gt; Async&lt;&#39;U&gt;<br />&#160;&#160;member Combine : computation1:Async&lt;unit&gt; * computation2:Async&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />&#160;&#160;member Delay : generator:(unit -&gt; Async&lt;&#39;T&gt;) -&gt; Async&lt;&#39;T&gt;<br />&#160;&#160;member For : sequence:seq&lt;&#39;T&gt; * body:(&#39;T -&gt; Async&lt;unit&gt;) -&gt; Async&lt;unit&gt;<br />&#160;&#160;member Return : value:&#39;T -&gt; Async&lt;&#39;T&gt;<br />&#160;&#160;member ReturnFrom : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />&#160;&#160;member TryFinally : computation:Async&lt;&#39;T&gt; * compensation:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />&#160;&#160;member TryWith : computation:Async&lt;&#39;T&gt; * catchHandler:(exn -&gt; Async&lt;&#39;T&gt;) -&gt; Async&lt;&#39;T&gt;<br />&#160;&#160;member Using : resource:&#39;T * binder:(&#39;T -&gt; Async&lt;&#39;U&gt;) -&gt; Async&lt;&#39;U&gt; (requires &#39;T :&gt; IDisposable)<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Control.AsyncBuilder</div>
<div class="tip" id="fs84">val x : AsyncBuilder</div>
<div class="tip" id="fs85">member AsyncBuilder.Bind : t:Task&lt;&#39;T&gt; * f:(&#39;T -&gt; Async&lt;&#39;R&gt;) -&gt; Async&lt;&#39;R&gt;<br /><br />Full name: Quatro.ExampleExtensions.Bind<br /><em><br /><br />&#160;An extension method that overloads the standard &#39;Bind&#39; of the &#39;async&#39; builder. The new overload awaits on<br />&#160;a standard .NET task</em></div>
<div class="tip" id="fs86">val t : Task&lt;&#39;T&gt;</div>
<div class="tip" id="fs87">Multiple items<br />type Task =<br />&#160;&#160;new : action:Action -&gt; Task + 7 overloads<br />&#160;&#160;member AsyncState : obj<br />&#160;&#160;member ContinueWith : continuationAction:Action&lt;Task&gt; -&gt; Task + 9 overloads<br />&#160;&#160;member CreationOptions : TaskCreationOptions<br />&#160;&#160;member Dispose : unit -&gt; unit<br />&#160;&#160;member Exception : AggregateException<br />&#160;&#160;member Id : int<br />&#160;&#160;member IsCanceled : bool<br />&#160;&#160;member IsCompleted : bool<br />&#160;&#160;member IsFaulted : bool<br />&#160;&#160;...<br /><br />Full name: System.Threading.Tasks.Task<br /><br />--------------------<br />type Task&lt;&#39;TResult&gt; =<br />&#160;&#160;inherit Task<br />&#160;&#160;new : function:Func&lt;&#39;TResult&gt; -&gt; Task&lt;&#39;TResult&gt; + 7 overloads<br />&#160;&#160;member ContinueWith : continuationAction:Action&lt;Task&lt;&#39;TResult&gt;&gt; -&gt; Task + 9 overloads<br />&#160;&#160;member Result : &#39;TResult with get, set<br />&#160;&#160;static member Factory : TaskFactory&lt;&#39;TResult&gt;<br /><br />Full name: System.Threading.Tasks.Task&lt;_&gt;<br /><br />--------------------<br />Task(action: Action) : unit<br />Task(action: Action, cancellationToken: Threading.CancellationToken) : unit<br />Task(action: Action, creationOptions: TaskCreationOptions) : unit<br />Task(action: Action&lt;obj&gt;, state: obj) : unit<br />Task(action: Action, cancellationToken: Threading.CancellationToken, creationOptions: TaskCreationOptions) : unit<br />Task(action: Action&lt;obj&gt;, state: obj, cancellationToken: Threading.CancellationToken) : unit<br />Task(action: Action&lt;obj&gt;, state: obj, creationOptions: TaskCreationOptions) : unit<br />Task(action: Action&lt;obj&gt;, state: obj, cancellationToken: Threading.CancellationToken, creationOptions: TaskCreationOptions) : unit<br /><br />--------------------<br />Task(function: Func&lt;&#39;TResult&gt;) : unit<br />Task(function: Func&lt;&#39;TResult&gt;, cancellationToken: Threading.CancellationToken) : unit<br />Task(function: Func&lt;&#39;TResult&gt;, creationOptions: TaskCreationOptions) : unit<br />Task(function: Func&lt;obj,&#39;TResult&gt;, state: obj) : unit<br />Task(function: Func&lt;&#39;TResult&gt;, cancellationToken: Threading.CancellationToken, creationOptions: TaskCreationOptions) : unit<br />Task(function: Func&lt;obj,&#39;TResult&gt;, state: obj, cancellationToken: Threading.CancellationToken) : unit<br />Task(function: Func&lt;obj,&#39;TResult&gt;, state: obj, creationOptions: TaskCreationOptions) : unit<br />Task(function: Func&lt;obj,&#39;TResult&gt;, state: obj, cancellationToken: Threading.CancellationToken, creationOptions: TaskCreationOptions) : unit</div>
<div class="tip" id="fs88">val f : (&#39;T -&gt; Async&lt;&#39;R&gt;)</div>
<div class="tip" id="fs89">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs90">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs91">member AsyncBuilder.Bind : t:Task * f:(unit -&gt; Async&lt;&#39;R&gt;) -&gt; Async&lt;&#39;R&gt;<br /><em><br /><br />&#160;An extension method that overloads the standard &#39;Bind&#39; of the &#39;async&#39; builder. The new overload awaits on<br />&#160;a standard .NET task which does not commpute a value</em><br />member AsyncBuilder.Bind : t:Task&lt;&#39;T&gt; * f:(&#39;T -&gt; Async&lt;&#39;R&gt;) -&gt; Async&lt;&#39;R&gt;<br /><em><br /><br />&#160;An extension method that overloads the standard &#39;Bind&#39; of the &#39;async&#39; builder. The new overload awaits on<br />&#160;a standard .NET task</em><br />member AsyncBuilder.Bind : computation:Async&lt;&#39;T&gt; * binder:(&#39;T -&gt; Async&lt;&#39;U&gt;) -&gt; Async&lt;&#39;U&gt;</div>
<div class="tip" id="fs92">static member Async.AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member Async.AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;</div>
<div class="tip" id="fs93">member AsyncBuilder.Bind : t:Task * f:(unit -&gt; Async&lt;&#39;R&gt;) -&gt; Async&lt;&#39;R&gt;<br /><br />Full name: Quatro.ExampleExtensions.Bind<br /><em><br /><br />&#160;An extension method that overloads the standard &#39;Bind&#39; of the &#39;async&#39; builder. The new overload awaits on<br />&#160;a standard .NET task which does not commpute a value</em></div>
<div class="tip" id="fs94">val t : Task</div>
<div class="tip" id="fs95">val f : (unit -&gt; Async&lt;&#39;R&gt;)</div>
<div class="tip" id="fs96">type unit = Unit<br /><br />Full name: Microsoft.FSharp.Core.unit</div>
<div class="tip" id="fs97">member AsyncBuilder.ReturnFrom : t:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br /><br />Full name: Quatro.ExampleExtensions.ReturnFrom</div>
<div class="tip" id="fs98">Multiple items<br />type RequireQualifiedAccessAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; RequireQualifiedAccessAttribute<br /><br />Full name: Microsoft.FSharp.Core.RequireQualifiedAccessAttribute<br /><br />--------------------<br />new : unit -&gt; RequireQualifiedAccessAttribute</div>
<div class="tip" id="fs99">Multiple items<br />namespace System.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs100">val establishEnvironment : database:string -&gt; conn:IConnection -&gt; Async&lt;unit&gt;<br /><br />Full name: Quatro.Data.establishEnvironment</div>
<div class="tip" id="fs101">val database : string</div>
<div class="tip" id="fs102">val conn : IConnection</div>
<div class="tip" id="fs103">val r : RethinkDB</div>
<div class="tip" id="fs104">val checkDatabase : (string -&gt; Async&lt;unit&gt;)</div>
<div class="tip" id="fs105">val db : string</div>
<div class="tip" id="fs106">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs107">val checkTables : (unit -&gt; Async&lt;unit&gt;)</div>
<div class="tip" id="fs108">val checkIndexes : (unit -&gt; Async&lt;unit&gt;)</div>
<div class="tip" id="fs109">val indexesFor : (&#39;a -&gt; Async&lt;string list&gt;)</div>
<div class="tip" id="fs110">val tbl : &#39;a</div>
<div class="tip" id="fs111">Ast.TopLevel.Table(expr: obj) : Ast.Table</div>
<div class="tip" id="fs112">val this : IConnection</div>
<div class="tip" id="fs113">member IConnection.EstablishEnvironment : database:string -&gt; Async&lt;unit&gt;<br /><br />Full name: Quatro.IConnectionExtensions.EstablishEnvironment</div>
<div class="tip" id="fs114">module App<br /><br />from Quatro</div>
<div class="tip" id="fs115">val lazyCfg : Lazy&lt;DataConfig&gt;<br /><br />Full name: Quatro.App.lazyCfg</div>
<div class="tip" id="fs116">type File =<br />&#160;&#160;static member AppendAllLines : path:string * contents:IEnumerable&lt;string&gt; -&gt; unit + 1 overload<br />&#160;&#160;static member AppendAllText : path:string * contents:string -&gt; unit + 1 overload<br />&#160;&#160;static member AppendText : path:string -&gt; StreamWriter<br />&#160;&#160;static member Copy : sourceFileName:string * destFileName:string -&gt; unit + 1 overload<br />&#160;&#160;static member Create : path:string -&gt; FileStream + 3 overloads<br />&#160;&#160;static member CreateText : path:string -&gt; StreamWriter<br />&#160;&#160;static member Decrypt : path:string -&gt; unit<br />&#160;&#160;static member Delete : path:string -&gt; unit<br />&#160;&#160;static member Encrypt : path:string -&gt; unit<br />&#160;&#160;static member Exists : path:string -&gt; bool<br />&#160;&#160;...<br /><br />Full name: System.IO.File</div>
<div class="tip" id="fs117">File.ReadAllText(path: string) : string<br />File.ReadAllText(path: string, encoding: Text.Encoding) : string</div>
<div class="tip" id="fs118">static member DataConfig.FromJson : json:&#39;a -&gt; DataConfig</div>
<div class="tip" id="fs119">val cfg : DataConfig<br /><br />Full name: Quatro.App.cfg</div>
<div class="tip" id="fs120">member Lazy.Force : unit -&gt; &#39;T</div>
<div class="tip" id="fs121">val deps : IDependencies<br /><br />Full name: Quatro.App.deps</div>
<div class="tip" id="fs122">val conn : Lazy&lt;IConnection&gt;</div>
<div class="tip" id="fs123">member DataConfig.CreateConnection : unit -&gt; IConnection</div>
<div class="tip" id="fs124">val main : &#39;a -&gt; int<br /><br />Full name: Quatro.App.main</div>
<div class="tip" id="fs125">val initDb : (IConnection -&gt; unit)</div>
<div class="tip" id="fs126">member IConnection.EstablishEnvironment : database:string -&gt; Async&lt;unit&gt;</div>
<div class="tip" id="fs127">property DataConfig.Database: string</div>
<div class="tip" id="fs128">static member Async.RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:Threading.CancellationToken -&gt; &#39;T</div>
<div class="tip" id="fs129">val start : ReaderM&lt;IDependencies,unit&gt;</div>
<div class="tip" id="fs130">Multiple items<br />module Data<br /><br />from Quatro<br /><br />--------------------<br />namespace System.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs131">val almost : (IConnection -&gt; Async&lt;unit&gt;)</div>
<div class="tip" id="fs132">val money : (IConnection -&gt; unit)</div>

        </div>
        <div class="span3">
          <img src="/FromObjectsToFunctions/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">objects () |> functions</li>
            <li><a href="/FromObjectsToFunctions/index.html">Home page</a></li>
            <li class="divider"></li>
            
            <li><a href="https://github.com/danieljsummers/FromObjectsToFunctions">Source Code on GitHub</a></li>
            <li><a href="/FromObjectsToFunctions/license.html">License</a></li>
            
            
            <li class="nav-header">Steps</li>
            <li><a href="/FromObjectsToFunctions/step1"><strong>1 |> Hello World</strong></a></li>
            <li><a href="/FromObjectsToFunctions/step2"><strong>2 |> Data Model</strong></a></li>
            <li><a href="/FromObjectsToFunctions/step3"><strong>3 |> RethinkDB Connection</strong></a></li>

            
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/danieljsummers/FromObjectsToFunctions"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
