<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>tres</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An attempt to provide a concrete, working example to demonstrate to C# developers how F# can improve their workflow and performance"/>
    <meta name="author" content="Daniel J. Summers"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/FromObjectsToFunctions/content/style.css" />
    <script type="text/javascript" src="/FromObjectsToFunctions/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/danieljsummers/FromObjectsToFunctions">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/FromObjectsToFunctions/index.html">objects () |> functions</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h3><a name="Tres-Step-2" class="anchor" href="#Tres-Step-2">Tres - Step 2</a></h3>
<p>As we make the leap to F#, we're changing things around significantly.  Remember our
<a href="../step1/tres.html">discussion about the flat structure of an F# project</a>?  Instead of an <code>Entities</code> directory with a
lot of little files, we'll define a single <code>Entities.fs</code> file in the root of the project.  Don't forget to add it to
the list of compiled files in <code>project.json</code>; it should go above <code>HomeModule.fs</code>.</p>
<p>Next up, we will change the static classes that we created to eliminate magic strings into modules.  The
<code>AuthorizationLevel</code> type in C# looked like:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> AuthorizationLevel
{
    <span class="k">const</span> <span class="k">string</span> Administrator <span class="o">=</span> <span class="s">"Administrator"</span>;

    <span class="k">const</span> <span class="k">string</span> User <span class="o">=</span> <span class="s">"User"</span>;
}
</code></pre></td></tr></table>
<p>The F# version (within the namespace <code>Tres.Entities</code>):</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="t">RequireQualifiedAccess</span>&gt;]
<span class="k">module</span> <span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="t">AuthorizationLevel</span> <span class="o">=</span>
  [&lt;<span onmouseout="hideTip(event, 'fs10', 10)" onmouseover="showTip(event, 'fs10', 10)" class="t">Literal</span>&gt;]
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 11)" onmouseover="showTip(event, 'fs11', 11)" class="i">Administrator</span> <span class="o">=</span> <span class="s">&quot;Administrator&quot;</span>
  [&lt;<span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="t">Literal</span>&gt;]
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 13)" onmouseover="showTip(event, 'fs12', 13)" class="i">User</span> <span class="o">=</span> <span class="s">&quot;User&quot;</span>
</code></pre></td>
</tr>
</table>
<p>The <code>RequireQualifiedAccess</code> attribute means that this module cannot be <code>open</code>ed, which means that <code>Administrator</code>
cannot ever be construed to be that value; it must be referenced as <code>AuthorizationLevel.Administrator</code>.  The
<code>Literal</code> attribute means that these values can be used in places where a literal string is required.  (There is a
specific place this will help us when we start writing code around these types.)  Also of note here is the different
way F# defines attributes from the way C# does; instead of <code>[</code> <code>]</code> pairs, we use <code>[&lt;</code> <code>&gt;]</code> pairs.</p>
<p>We are also going to change from class types to record types.  Record types can be thought of as <code>struct</code>s, though the
comparison is not exact; record types are reference types, not value types, but they cannot be set to null <strong>in code</strong>
<em>(huge caveat which we'll see in the next step)</em> unless explicitly identified.  We're also going to embrace F#'s
immutability-by-default qualities that will save us a heap of null checks (as well as those pesky situations where we
forget to implement them).</p>
<p>As a representative example, consider the <code>Page</code> type.  In C#, it looks like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">namespace</span> Uno.Entities
{
    <span class="k">using</span> Newtonsoft.Json;
    <span class="k">using</span> System.Collections.Generic;
    
    <span class="k">public</span> <span class="k">class</span> Page
    {
        [JsonProperty(<span class="s">"id"</span>)]
        <span class="k">public</span> <span class="k">string</span> Id { get; set; }
        
        <span class="k">public</span> <span class="k">string</span> WebLogId { get; set; }
        
        <span class="k">public</span> <span class="k">string</span> AuthorId { get; set; }
        
        <span class="k">public</span> <span class="k">string</span> Title { get; set; }
        
        <span class="k">public</span> <span class="k">string</span> Permalink { get; set; }
        
        <span class="k">public</span> <span class="k">long</span> PublishedOn { get; set; }
        
        <span class="k">public</span> <span class="k">long</span> UpdatedOn { get; set; }
        
        <span class="k">public</span> <span class="k">bool</span> ShowInPageList { get; set; }
        
        <span class="k">public</span> <span class="k">string</span> Text { get; set; }
        
        <span class="k">public</span> ICollection&lt;Revision&gt; Revisions { get; set; } <span class="o">=</span> <span class="k">new</span> List&lt;Revision&gt;(); 
    }
}
</code></pre></td></tr></table>
<p>It contains strings, for the most part, and a <code>Revisions</code> collection.  Now, here's how we'll implement this same thing
in F#:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">namespace</span> <span class="i">Tres</span><span class="o">.</span><span class="i">Entities</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs13', 14)" onmouseover="showTip(event, 'fs13', 14)" class="i">Newtonsoft</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 15)" onmouseover="showTip(event, 'fs14', 15)" class="i">Json</span>
<span class="c">//...</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs15', 16)" onmouseover="showTip(event, 'fs15', 16)" class="t">Page</span> <span class="o">=</span> {
  [&lt;<span onmouseout="hideTip(event, 'fs16', 17)" onmouseover="showTip(event, 'fs16', 17)" class="t">JsonProperty</span>(<span class="s">&quot;id&quot;</span>)&gt;]
  <span onmouseout="hideTip(event, 'fs17', 18)" onmouseover="showTip(event, 'fs17', 18)" class="i">Id</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 19)" onmouseover="showTip(event, 'fs6', 19)" class="t">string</span>
  <span onmouseout="hideTip(event, 'fs18', 20)" onmouseover="showTip(event, 'fs18', 20)" class="i">WebLogId</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 21)" onmouseover="showTip(event, 'fs6', 21)" class="t">string</span>
  <span onmouseout="hideTip(event, 'fs19', 22)" onmouseover="showTip(event, 'fs19', 22)" class="i">AuthorId</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 23)" onmouseover="showTip(event, 'fs6', 23)" class="t">string</span>
  <span onmouseout="hideTip(event, 'fs20', 24)" onmouseover="showTip(event, 'fs20', 24)" class="i">Title</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 25)" onmouseover="showTip(event, 'fs6', 25)" class="t">string</span>
  <span onmouseout="hideTip(event, 'fs21', 26)" onmouseover="showTip(event, 'fs21', 26)" class="i">Permalink</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 27)" onmouseover="showTip(event, 'fs6', 27)" class="t">string</span>
  <span onmouseout="hideTip(event, 'fs22', 28)" onmouseover="showTip(event, 'fs22', 28)" class="i">PublishedOn</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 29)" onmouseover="showTip(event, 'fs4', 29)" class="t">int64</span>
  <span onmouseout="hideTip(event, 'fs23', 30)" onmouseover="showTip(event, 'fs23', 30)" class="i">UpdatedOn</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 31)" onmouseover="showTip(event, 'fs4', 31)" class="t">int64</span>
  <span onmouseout="hideTip(event, 'fs24', 32)" onmouseover="showTip(event, 'fs24', 32)" class="i">ShowInPageList</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs25', 33)" onmouseover="showTip(event, 'fs25', 33)" class="t">bool</span>
  <span onmouseout="hideTip(event, 'fs26', 34)" onmouseover="showTip(event, 'fs26', 34)" class="i">Text</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs6', 35)" onmouseover="showTip(event, 'fs6', 35)" class="t">string</span>
  <span onmouseout="hideTip(event, 'fs27', 36)" onmouseover="showTip(event, 'fs27', 36)" class="i">Revisions</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs28', 37)" onmouseover="showTip(event, 'fs28', 37)" class="t">Revision</span> <span onmouseout="hideTip(event, 'fs29', 38)" onmouseover="showTip(event, 'fs29', 38)" class="t">list</span>
  }
<span class="k">with</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs30', 39)" onmouseover="showTip(event, 'fs30', 39)" class="i">Empty</span> <span class="o">=</span> 
    { <span class="i">Id</span>             <span class="o">=</span> <span class="s">&quot;&quot;</span>
      <span class="i">WebLogId</span>       <span class="o">=</span> <span class="s">&quot;&quot;</span>
      <span class="i">AuthorId</span>       <span class="o">=</span> <span class="s">&quot;&quot;</span>
      <span class="i">Title</span>          <span class="o">=</span> <span class="s">&quot;&quot;</span>
      <span class="i">Permalink</span>      <span class="o">=</span> <span class="s">&quot;&quot;</span>
      <span class="i">PublishedOn</span>    <span class="o">=</span> <span class="n">0L</span>
      <span class="i">UpdatedOn</span>      <span class="o">=</span> <span class="n">0L</span>
      <span class="i">ShowInPageList</span> <span class="o">=</span> <span class="k">false</span>
      <span class="i">Text</span>           <span class="o">=</span> <span class="s">&quot;&quot;</span>
      <span class="i">Revisions</span>      <span class="o">=</span> []
      }
</code></pre></td>
</tr>
</table>
<p>The field declarations immediately under the <code>type</code> declaration mirror those in our C# version; since they are fields,
though, we don't have to define getters and setters.</p>
<p>F# requires record types to always have all fields defined.  F# also provides a <code>with</code> statement (separate from the one
in the code above) that allows us to create a new instance of a record type that has all the fields of our original
ones, only replacing the ones we specify.  So, in C#, while we can do something like</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">var</span> pg <span class="o">=</span> <span class="k">new</span> Page { Title <span class="o">=</span> <span class="s">"Untitled"</span> };
</code></pre></td></tr></table>
<p>, leaving all the other fields in their otherwise-initialized state, F# will not allow us to do that.  This is where
the <code>Empty</code> static property comes in; we can use this to create new pages, while ensuring that we have sensible
defaults for all the other fields.  The equivalent to the above C# statement in F# would be</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">pg</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs15', 40)" onmouseover="showTip(event, 'fs15', 40)" class="i">Page</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 41)" onmouseover="showTip(event, 'fs31', 41)" class="i">Empty</span> <span class="k">with</span> <span class="i">Title</span> <span class="o">=</span> <span class="s">&quot;Untitled&quot;</span> }
</code></pre></td>
</tr>
</table>
<p>.  Note the default values for <code>Permalink</code>: in C#, it's null, but in F#, it's an empty string.  Now, certainly, you can
use <code>String.IsNullOrEmpty()</code> to check for both of those, but we'll see some advantages to this lack of nullability as
we continue to develop this project.</p>
<p>A few syntax notes:
- <code>[]</code> represents an empty list in F#.  An F# list (as distinguished from <code>System.Collections.List</code> or
<code>System.Collections.Generic.List&lt;T&gt;</code>) is also an immutable data structure; it consists of a head element, and a tail
list.  It can be constructed by creating a new list with an element as its head and the existing list as its tail, and
deconstructed by processing the head, then processing the head of the tail, etc.  (There are operators and functions to
support that; we'll definitely use those as we go along.)  Items in a list are separated by semicolons;
<code>[ "one"; "two"; "three" ]</code> represents a <code>string list</code> with three items.  It supports most all the collection
operations you would expect, but there are some differences.
- While not demonstrated here, arrays are defined between <code>[|</code> <code>|]</code> pairs, also with elements separated by semicolons.</p>
<p>Before continuing on to <a href="quatro.html">Quatro</a>, you should familiarize yourself with the
<a href="https://github.com/danieljsummers/FromObjectsToFunctions/tree/step-2/src/3-Nancy-FSharp/Entities.fs">types in this step</a>.</p>
<p><a href="../step2">Back to Step 2</a></p>

<div class="tip" id="fs1">namespace Tres</div>
<div class="tip" id="fs2">namespace Tres.Entities</div>
<div class="tip" id="fs3">Revision.AsOf: int64</div>
<div class="tip" id="fs4">Multiple items<br />val int64 : value:&#39;T -&gt; int64 (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int64<br /><br />--------------------<br />type int64 = System.Int64<br /><br />Full name: Microsoft.FSharp.Core.int64<br /><br />--------------------<br />type int64&lt;&#39;Measure&gt; = int64<br /><br />Full name: Microsoft.FSharp.Core.int64&lt;_&gt;</div>
<div class="tip" id="fs5">Revision.Text: string</div>
<div class="tip" id="fs6">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs7">static member Revision.Empty : Revision<br /><br />Full name: Tres.Entities.Revision.Empty</div>
<div class="tip" id="fs8">Multiple items<br />type RequireQualifiedAccessAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; RequireQualifiedAccessAttribute<br /><br />Full name: Microsoft.FSharp.Core.RequireQualifiedAccessAttribute<br /><br />--------------------<br />new : unit -&gt; RequireQualifiedAccessAttribute</div>
<div class="tip" id="fs9">module AuthorizationLevel<br /><br />from Tres.Entities</div>
<div class="tip" id="fs10">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs11">val Administrator : string<br /><br />Full name: Tres.Entities.AuthorizationLevel.Administrator</div>
<div class="tip" id="fs12">val User : string<br /><br />Full name: Tres.Entities.AuthorizationLevel.User</div>
<div class="tip" id="fs13">namespace Newtonsoft</div>
<div class="tip" id="fs14">namespace Newtonsoft.Json</div>
<div class="tip" id="fs15">type Page =<br />&#160;&#160;{Id: string;<br />&#160;&#160;&#160;WebLogId: string;<br />&#160;&#160;&#160;AuthorId: string;<br />&#160;&#160;&#160;Title: string;<br />&#160;&#160;&#160;Permalink: string;<br />&#160;&#160;&#160;PublishedOn: int64;<br />&#160;&#160;&#160;UpdatedOn: int64;<br />&#160;&#160;&#160;ShowInPageList: bool;<br />&#160;&#160;&#160;Text: string;<br />&#160;&#160;&#160;Revisions: Revision list;}<br />&#160;&#160;static member Empty : Page<br /><br />Full name: Tres.Entities.Page</div>
<div class="tip" id="fs16">Multiple items<br />type JsonPropertyAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; JsonPropertyAttribute + 1 overload<br />&#160;&#160;member DefaultValueHandling : DefaultValueHandling with get, set<br />&#160;&#160;member IsReference : bool with get, set<br />&#160;&#160;member ItemConverterParameters : obj[] with get, set<br />&#160;&#160;member ItemConverterType : Type with get, set<br />&#160;&#160;member ItemIsReference : bool with get, set<br />&#160;&#160;member ItemReferenceLoopHandling : ReferenceLoopHandling with get, set<br />&#160;&#160;member ItemTypeNameHandling : TypeNameHandling with get, set<br />&#160;&#160;member NamingStrategyParameters : obj[] with get, set<br />&#160;&#160;member NamingStrategyType : Type with get, set<br />&#160;&#160;...<br /><br />Full name: Newtonsoft.Json.JsonPropertyAttribute<br /><br />--------------------<br />JsonPropertyAttribute() : unit<br />JsonPropertyAttribute(propertyName: string) : unit</div>
<div class="tip" id="fs17">Page.Id: string</div>
<div class="tip" id="fs18">Page.WebLogId: string</div>
<div class="tip" id="fs19">Page.AuthorId: string</div>
<div class="tip" id="fs20">Page.Title: string</div>
<div class="tip" id="fs21">Page.Permalink: string</div>
<div class="tip" id="fs22">Page.PublishedOn: int64</div>
<div class="tip" id="fs23">Page.UpdatedOn: int64</div>
<div class="tip" id="fs24">Page.ShowInPageList: bool</div>
<div class="tip" id="fs25">type bool = System.Boolean<br /><br />Full name: Microsoft.FSharp.Core.bool</div>
<div class="tip" id="fs26">Page.Text: string</div>
<div class="tip" id="fs27">Page.Revisions: Revision list</div>
<div class="tip" id="fs28">type Revision =<br />&#160;&#160;{AsOf: int64;<br />&#160;&#160;&#160;Text: string;}<br />&#160;&#160;static member Empty : Revision<br /><br />Full name: Tres.Entities.Revision</div>
<div class="tip" id="fs29">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs30">static member Page.Empty : Page<br /><br />Full name: Tres.Entities.Page.Empty</div>
<div class="tip" id="fs31">property Page.Empty: Page</div>

        </div>
        <div class="span3">
          <img src="/FromObjectsToFunctions/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">objects () |> functions</li>
            <li><a href="/FromObjectsToFunctions/index.html">Home page</a></li>
            <li class="divider"></li>
            
            <li><a href="https://github.com/danieljsummers/FromObjectsToFunctions">Source Code on GitHub</a></li>
            <li><a href="/FromObjectsToFunctions/license.html">License</a></li>
            
            
            <li class="nav-header">Steps</li>
            <li><a href="/FromObjectsToFunctions/step1"><strong>1 |> Hello World</strong></a></li>
            <li><a href="/FromObjectsToFunctions/step2"><strong>2 |> Data Model</strong></a></li>
            <li><a href="/FromObjectsToFunctions/step3"><strong>3 |> RethinkDB Connection</strong></a></li>

            
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/danieljsummers/FromObjectsToFunctions"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
